---
title: "Austin-Daily-Temps"
author: "Allison Davis Connelly"
date: "2025-04-17"
output: 
  html_document:
    toc: TRUE
    toc_depth: 5
    toc_float:
      collapsed: FALSE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Purpose

We were interested in how the temperature rates used in our CTmax and CTmin trials (+/- 0.3°C/min) compared to those our specimens were exposed to in their original habitat. We calculated the daily temperature change rates (°C/min) for 2020-2024 in Austin. TX. We then isolated the highest positive and negative rates for each month in 2020-2024 to illustrate how our rates compare to past extreme weather events. 

# Data

Temperature data were collected from Camp Maybury in Austin, TX (NOAA, National Centers for Environmental Information, https://www.ncei.noaa.gov/access/search/data-search/local-climatological-data-v2). Data reflect dry bulb temperatures recorded every hour for all months in 2020-2024. 

All analyses were conducted using R version 4.4.2 

## Load required libraries

Remove the '#' in the code below if it is the first time installing library. 

```{r}
#install.packages("curl")             #v5.2.1
library(curl)

#install.packages("dplyr")            #v1.1.4
library(dplyr)

#install.packages("broom")            #v1.0.6
#library(broom)

#install.packages("lubridate")        #1.9.3
library(lubridate)

#install.packages("ggplot2")          #v3.5.1
library(ggplot2)

#install.packages("gt")               #v0.11.1
library(gt)

```

## Read in data.

```{r}

temp <- curl("https://raw.githubusercontent.com/allisondavis/Temperature/refs/heads/main/Austin_temp-data.csv")

temp <- read.csv(temp, header = TRUE, sep = ",", stringsAsFactors = TRUE)
head(temp)

# Change date from month-day-year to year-month-day
temp$DATE <- as.Date(temp$DATE, format="%m/%d/%Y")

# Create separate columns for year (YYYY), month (NAME), and day (DD)

temp <- temp %>%
  mutate(
    Year = format(DATE, "%Y"),  
    Month = format(DATE, "%B"),  
    Day = format(DATE, "%d"))

# Convert time to minutes

temp <- temp %>%
  mutate(
    time_obj = hms(as.character(HOUR)),
    minutes = hour(time_obj) * 60 + minute(time_obj) + second(time_obj) / 60)

# Individual data frames for per year analysis

vente <- temp[temp$Year == "2020",]

ven.uno <- temp[temp$Year == "2021",]

ven.dos <- temp[temp$Year == "2022",]

ven.tres <- temp[temp$Year == "2023",]

ven.quat <- temp[temp$Year == "2024",]


```

# Analysis

We fit a simple linear model to determine rate of tempearture change using hourly dry bulb temperatures per minute. All temperature rates are calculated as °C/minute to reflect the rate units used in our trials. 

## 2020 temps


```{r}

# Filter 
df <- vente %>%
  mutate(Month = factor(Month, levels = month.name)) %>%
  filter(!is.na(HourlyDryBulbTemperature), !is.na(minutes))


# Fit a linear model of temp ~ minutes for each date
slopes.20 <- df %>%
  group_by(Month, Day) %>%
  summarise(slope_deg_per_minute = coef(lm(HourlyDryBulbTemperature ~ minutes))[2])


# present as a table
slopes.20 %>%
  arrange(Month) %>%
    gt() %>%
    tab_header(title = "Temp change in Austin, 2020") %>%
    cols_label(Month ="Month",
               slope_deg_per_minute = "Temp change (°C/min)") %>%
    fmt_number(columns = c("slope_deg_per_minute"), decimals = 3) %>%
  tab_style(
      style = cell_borders(sides = "right", color = "lightgray", weight = px(1.5)),
      locations = cells_body(columns = Day)) %>%
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(columns = everything())) %>%
   opt_horizontal_padding(scale=2)

```

## 2021 temps

```{r}
# Filter 
df <- ven.uno %>%
  mutate(Month = factor(Month, levels = month.name)) %>%
  filter(!is.na(HourlyDryBulbTemperature), !is.na(minutes))


# Fit a linear model of temp ~ minutes for each date
slopes.21 <- df %>%
  group_by(Month, Day) %>%
  summarise(slope_deg_per_minute = coef(lm(HourlyDryBulbTemperature ~ minutes))[2])


# present as a table
slopes.21 %>%
  arrange(Month) %>%
    gt() %>%
    tab_header(title = "Temp change in Austin, 2021") %>%
    cols_label(Month ="Month",
               slope_deg_per_minute = "Temp change (°C/min)") %>%
    fmt_number(columns = c("slope_deg_per_minute"), decimals = 3) %>%
  tab_style(
      style = cell_borders(sides = "right", color = "lightgray", weight = px(1.5)),
      locations = cells_body(columns = Day)) %>%
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(columns = everything())) %>%
  opt_horizontal_padding(scale=2)


```


## 2022 temps

```{r}

# Filter 
df <- ven.dos %>%
  mutate(Month = factor(Month, levels = month.name)) %>%
  filter(!is.na(HourlyDryBulbTemperature), !is.na(minutes))


# Fit a linear model of temp ~ minutes for each date
slopes.22 <- df %>%
  group_by(Month, Day) %>%
  summarise(slope_deg_per_minute = coef(lm(HourlyDryBulbTemperature ~ minutes))[2])


# present as a table
slopes.22 %>%
  arrange(Month) %>%
    gt() %>%
    tab_header(title = "Temp change in Austin, 2022") %>%
    cols_label(Month ="Month",
               slope_deg_per_minute = "Temp change (°C/min)") %>%
    fmt_number(columns = c("slope_deg_per_minute"), decimals = 3) %>%
  tab_style(
      style = cell_borders(sides = "right", color = "lightgray", weight = px(1.5)),
      locations = cells_body(columns = Day)) %>%
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(columns = everything())) %>%
   opt_horizontal_padding(scale=2)



```


## 2023 temps

```{r}

# Filter 
df <- ven.tres %>%
  mutate(Month = factor(Month, levels = month.name)) %>%
  filter(!is.na(HourlyDryBulbTemperature), !is.na(minutes))


# Fit a linear model of temp ~ minutes for each date
slopes.23 <- df %>%
  group_by(Month, Day) %>%
  summarise(slope_deg_per_minute = coef(lm(HourlyDryBulbTemperature ~ minutes))[2])


# present as a table
slopes.23 %>%
  arrange(Month) %>%
    gt() %>%
    tab_header(title = "Temp change in Austin, 2023") %>%
    cols_label(Month ="Month",
               slope_deg_per_minute = "Temp change (°C/min)") %>%
    fmt_number(columns = c("slope_deg_per_minute"), decimals = 3) %>%
  tab_style(
      style = cell_borders(sides = "right", color = "lightgray", weight = px(1.5)),
      locations = cells_body(columns = Day)) %>%
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(columns = everything())) %>%
   opt_horizontal_padding(scale=2)


```


## 2024 temps

```{r}

# Filter 
df <- ven.quat %>%
  mutate(Month = factor(Month, levels = month.name)) %>%
  filter(!is.na(HourlyDryBulbTemperature), !is.na(minutes))


# Fit a linear model of temp ~ minutes for each date
slopes.24 <- df %>%
  group_by(Month, Day) %>%
  summarise(slope_deg_per_minute = coef(lm(HourlyDryBulbTemperature ~ minutes))[2])


# present as a table
slopes.24 %>%
  arrange(Month) %>%
    gt() %>%
    tab_header(title = "Temp change in Austin, 2024") %>%
    cols_label(Month ="Month",
               slope_deg_per_minute = "Temp change (°C/min)") %>%
    fmt_number(columns = c("slope_deg_per_minute"), decimals = 3) %>%
  tab_style(
      style = cell_borders(sides = "right", color = "lightgray", weight = px(1.5)),
      locations = cells_body(columns = Day)) %>%
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(columns = everything())) %>%
   opt_horizontal_padding(scale=2)


```




## Highest temp changes

We isolated the highest positive and highest negative temperature rates for each month to illustrate how our rates compare to past extreme weather events. 

### 2020

```{r}

# Isolate highest positive and negative rates
extreme_slopes <- slopes.20 %>%
  arrange(Month, slope_deg_per_minute) %>%
  group_by(Month) %>%
  mutate(Month_display = if_else(row_number() == 1, as.character(Month), "")) %>%
  filter(
    slope_deg_per_minute == max(slope_deg_per_minute) |
    slope_deg_per_minute == min(slope_deg_per_minute)) %>%
  ungroup()


# Present as a table
extreme_slopes %>%
  gt() %>%
  tab_header(title = "Most Extreme Temp Changes by Month, 2020") %>%
  cols_hide(columns = Month) %>%
  cols_move_to_start(columns = Month_display) %>%
  cols_label(
    Month_display = "Month",
    Day = "Date",
    slope_deg_per_minute = "Temp Change (°C/min)") %>%
  fmt_number(columns = slope_deg_per_minute, decimals = 3) %>%
  tab_style(
    style = cell_borders(sides = "right", color = "lightgray", weight = px(1.5)),
    locations = cells_body(columns = c(Month_display, Day))) %>%
  cols_align(align="center", everything())

```


### 2021

```{r}

# Isolate highest positive and negative rates
extreme_slopes <- slopes.21 %>%
  arrange(Month, slope_deg_per_minute) %>%
  group_by(Month) %>%
  mutate(Month_display = if_else(row_number() == 1, as.character(Month), "")) %>%
  filter(
    slope_deg_per_minute == max(slope_deg_per_minute) |
    slope_deg_per_minute == min(slope_deg_per_minute)) %>%
  ungroup()


# Present as a table
extreme_slopes %>%
  gt() %>%
  tab_header(title = "Most Extreme Temp Changes by Month, 2021") %>%
  cols_hide(columns = Month) %>%
  cols_move_to_start(columns = Month_display) %>%
  cols_label(
    Month_display = "Month",
    Day = "Date",
    slope_deg_per_minute = "Temp Change (°C/min)") %>%
  fmt_number(columns = slope_deg_per_minute, decimals = 3) %>%
  tab_style(
    style = cell_borders(sides = "right", color = "lightgray", weight = px(1.5)),
    locations = cells_body(columns = c(Month_display, Day))) %>%
  cols_align(align="center", everything())

```


### 2022

```{r}

# Isolate highest positive and negative rates
extreme_slopes <- slopes.22 %>%
  arrange(Month, slope_deg_per_minute) %>%
  group_by(Month) %>%
  mutate(Month_display = if_else(row_number() == 1, as.character(Month), "")) %>%
  filter(
    slope_deg_per_minute == max(slope_deg_per_minute) |
    slope_deg_per_minute == min(slope_deg_per_minute)) %>%
  ungroup()


# Present as a table
extreme_slopes %>%
  gt() %>%
  tab_header(title = "Most Extreme Temp Changes by Month, 2022") %>%
  cols_hide(columns = Month) %>%
  cols_move_to_start(columns = Month_display) %>%
  cols_label(
    Month_display = "Month",
    Day = "Date",
    slope_deg_per_minute = "Temp Change (°C/min)") %>%
  fmt_number(columns = slope_deg_per_minute, decimals = 3) %>%
  tab_style(
    style = cell_borders(sides = "right", color = "lightgray", weight = px(1.5)),
    locations = cells_body(columns = c(Month_display, Day))) %>%
  cols_align(align="center", everything())

```

### 2023

```{r}

# Isolate highest positive and negative rates
extreme_slopes <- slopes.23 %>%
  arrange(Month, slope_deg_per_minute) %>%
  group_by(Month) %>%
  mutate(Month_display = if_else(row_number() == 1, as.character(Month), "")) %>%
  filter(
    slope_deg_per_minute == max(slope_deg_per_minute) |
    slope_deg_per_minute == min(slope_deg_per_minute)) %>%
  ungroup()


# Present as a table
extreme_slopes %>%
  gt() %>%
  tab_header(title = "Most Extreme Temp Changes by Month, 2023") %>%
  cols_hide(columns = Month) %>%
  cols_move_to_start(columns = Month_display) %>%
  cols_label(
    Month_display = "Month",
    Day = "Date",
    slope_deg_per_minute = "Temp Change (°C/min)") %>%
  fmt_number(columns = slope_deg_per_minute, decimals = 3) %>%
  tab_style(
    style = cell_borders(sides = "right", color = "lightgray", weight = px(1.5)),
    locations = cells_body(columns = c(Month_display, Day))) %>%
  cols_align(align="center", everything())
```

### 2024

```{r}

# Isolate highest positive and negative rates
extreme_slopes <- slopes.24 %>%
  arrange(Month, slope_deg_per_minute) %>%
  group_by(Month) %>%
  mutate(Month_display = if_else(row_number() == 1, as.character(Month), "")) %>%
  filter(
    slope_deg_per_minute == max(slope_deg_per_minute) |
    slope_deg_per_minute == min(slope_deg_per_minute)) %>%
  ungroup()


# Present as a table
extreme_slopes %>%
  gt() %>%
  tab_header(title = "Most Extreme Temp Changes by Month, 2024") %>%
  cols_hide(columns = Month) %>%
  cols_move_to_start(columns = Month_display) %>%
  cols_label(
    Month_display = "Month",
    Day = "Date",
    slope_deg_per_minute = "Temp Change (°C/min)") %>%
  fmt_number(columns = slope_deg_per_minute, decimals = 3) %>%
  tab_style(
    style = cell_borders(sides = "right", color = "lightgray", weight = px(1.5)),
    locations = cells_body(columns = c(Month_display, Day))) %>%
  cols_align(align="center", everything())
```

### Overall averages

```{r}

# Create overall slope data set
df <- temp %>%
  mutate(Month = factor(Month, levels = month.name)) %>%
  filter(!is.na(HourlyDryBulbTemperature), !is.na(minutes))

slopes <- df %>%
  group_by(Year, Month, Day) %>%
  summarise(slope_deg_per_minute = coef(lm(HourlyDryBulbTemperature ~ minutes))[2])


# Averages by year 

annual_avg_rates <- slopes %>%
  group_by(Year) %>%
  summarise(
    avg_positive_rate = mean(slope_deg_per_minute[slope_deg_per_minute > 0], na.rm = TRUE),
    avg_negative_rate = mean(slope_deg_per_minute[slope_deg_per_minute < 0], na.rm = TRUE)) %>%
  gt() %>%
  cols_label(
    Year = "Year",
    avg_positive_rate = "Average increase (°C/min)",
    avg_negative_rate = "Average decrease (°C/min)") %>%
  fmt_number(columns = c(avg_positive_rate, avg_negative_rate), decimals = 3) %>%
  tab_style(
    style = cell_borders(sides = "right", color = "lightgray", weight = px(1.5)),
    locations = cells_body(columns = c(Year, avg_positive_rate))) %>%
  cols_align(align="center", everything()) %>%
  opt_horizontal_padding(scale = 2)

annual_avg_rates



# Overall averages 


overall_avg_rates <- slopes %>%
  ungroup() %>%
  summarise(
    avg_positive_rate = mean(slope_deg_per_minute[slope_deg_per_minute > 0], na.rm = TRUE),
    avg_negative_rate = mean(slope_deg_per_minute[slope_deg_per_minute < 0], na.rm = TRUE)) %>%
  gt() %>%
  cols_label(avg_positive_rate = "Average increase (°C/min)",
    avg_negative_rate = "Average decrease (°C/min)") %>%
  fmt_number(columns = c(avg_positive_rate, avg_negative_rate), decimals = 3) %>%
  tab_style(
    style = cell_borders(sides = "right", color = "lightgray", weight = px(1.5)),
    locations = cells_body(columns = avg_positive_rate)) %>%
  cols_align(align="center", everything()) %>%
  opt_horizontal_padding(scale = 2)

overall_avg_rates

```


# Summary

The rate of temperature change in our trials was set to +/-0.3°C/min as this was slow enough to ensure matching internal body change and fast enough to prevent acclimation. As shown above, this rate is far higher than that experienced in Austin, TX for the past five years. This time frame includes extreme weather events such as the winter storm NAME in 2019, but rates do not mirror this EXTREMITY? While our test rates may illustrate the physiological tolerances of our fish species, trials mimicking the extreme temperature rates actually experienced may provide a more accurate image of THERMAL THREAT?? 
